(this.webpackJsonpnormalmaptfjs=this.webpackJsonpnormalmaptfjs||[]).push([[0],{14:function(e,n,t){},16:function(e,n,t){},18:function(e,n,t){"use strict";t.r(n);var a=t(1),r=t.n(a),i=t(5),o=t.n(i),s=(t(14),t(2)),c=t.n(s),u=t(4),l=t(6),p=t(7),m=t(9),d=t(8),h=(t.p,t(16),t(0)),f=function(e){Object(m.a)(t,e);var n=Object(d.a)(t);function t(e){var a;return Object(l.a)(this,t),(a=n.call(this,e)).initClass=Object(u.a)(c.a.mark((function e(){var n,t,r,i,o,s,u,l,p,m,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.tf,!a.inited){e.next=3;break}return e.abrupt("return");case 3:return a.inited=!0,t=document.getElementById("log"),(r=function(e){t.innerHTML+=e+"\n"})("started"),e.prev=7,e.next=10,n.loadLayersModel("/NormalMapTFJS/modelClassOrient/model.json");case 10:return i=e.sent,console.log(i),o=64,s=64,i.inputs[0].shape=[null,8*s,8*o,3],i.inputLayers[0].batchInputShape=[null,8*s,8*o,3],i.inputLayers[0].inputSpec[0].shape=[null,8*s,8*o,3],i.feedInputShapes[0]=[null,8*s,8*o,3],i.internalInputShapes[0]=[null,8*s,8*o,3],i.inputs[1].shape=[null,s/16,o/16,1],i.inputLayers[1].batchInputShape=[null,s/16,o/16,1],i.inputLayers[1].inputSpec[0].shape=[null,s/16,o/16,1],i.feedInputShapes[1]=[null,s/16,o/16,1],i.internalInputShapes[1]=[null,s/16,o/16,1],DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&DeviceMotionEvent.requestPermission(),u=0,window.addEventListener("deviceorientation",(function(e){u=(e.beta-90)/180})),r("loaded"),e.next=30,navigator.mediaDevices.getUserMedia({video:{aspectRatio:{ideal:1},facingMode:"environment"}});case 30:return l=e.sent,r("capture"),(p=document.getElementById("video")).srcObject=l,e.next=36,p.play();case 36:m=document.getElementById("result"),m.getContext("2d"),d=function e(){var t=n.tidy((function(){r("req");try{var e=n.browser.fromPixels(p).expandDims().div(255);e=n.image.resizeBilinear(e,[512,512]),r("req1");var t=new Date,a=i.predict([e,n.tensor(new Float32Array(s/16*(o/16)).map((function(e){return u})),[1,s/16,o/16,1])]);r("req2");var c=(a=a.reshape(a.shape.slice(1)).slice([0,0,0],[s,o,36])).dataSync();console.log("t",new Date-t);for(var l=new Float32Array(s*o*3),m=0;m!==s;m++)for(var d=0;d!==o;d++){for(var h=0,f=0,v=0;18!==v;v++)h<c[m*o*36+36*d+v]&&(h+=v*Math.pow(Math.max(c[m*o*36+36*d+v],0),2),f+=Math.pow(Math.max(c[m*o*36+36*d+v],0),2));var x=Math.min(Math.max(h/f*15,0),255);h=0,f=0;for(var M=0;18!==M;M++)h<c[m*o*36+36*d+M+18]&&(h+=M*Math.pow(Math.max(c[m*o*36+36*d+M+18],0),2),f+=Math.pow(Math.max(c[m*o*36+36*d+M+18],0),2));var g=Math.min(Math.max(h/f*15,0),255);l[m*o*3+3*d+0]=x,l[m*o*3+3*d+1]=g,l[m*o*3+3*d+2]=0}return n.tensor(l,[s,o,3],"int32").maximum(0).minimum(255).toInt()}catch(b){console.log("err: ",b),r(b.message)}}));console.log(t,m),n.browser.toPixels(t,m).then((function(){r("req3"),t.dispose(),requestAnimationFrame(e)})).catch((function(e){r(e.message)}))},requestAnimationFrame(d),e.next=45;break;case 42:e.prev=42,e.t0=e.catch(7),r(e.t0.message);case 45:case"end":return e.stop()}}),e,null,[[7,42]])}))),a.initImg=Object(u.a)(c.a.mark((function e(){var n,t,r,i,o,s,u,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.tf,!a.inited){e.next=3;break}return e.abrupt("return");case 3:return a.inited=!0,(t=document.getElementById("but")).innerHTML="started",e.next=8,n.loadLayersModel("/NormalMapTFJS/modelClassOrient/model.json");case 8:return r=e.sent,console.log(r),i=64,o=64,r.inputs[0].shape=[null,8*o,8*i,3],r.inputLayers[0].batchInputShape=[null,8*o,8*i,3],r.inputLayers[0].inputSpec[0].shape=[null,8*o,8*i,3],r.feedInputShapes[0]=[null,8*o,8*i,3],r.internalInputShapes[0]=[null,8*o,8*i,3],r.inputs[1].shape=[null,o/16,i/16,1],r.inputLayers[1].batchInputShape=[null,o/16,i/16,1],r.inputLayers[1].inputSpec[0].shape=[null,o/16,i/16,1],r.feedInputShapes[1]=[null,o/16,i/16,1],r.internalInputShapes[1]=[null,o/16,i/16,1],t.innerHTML="loaded",e.next=25,new Promise((function(e){var n=new Image;n.onload=function(){return e(n)},n.src="/NormalMapTFJS/test.png"}));case 25:s=e.sent,t.innerHTML="capture",u=document.getElementById("result"),u.getContext("2d"),l=function e(){var a=n.tidy((function(){t.innerHTML="req";try{var e=n.browser.fromPixels(s).expandDims().div(255);e=n.image.resizeBilinear(e,[8*o,8*i]);var a=new Date,c=r.predict([e,n.tensor(new Float32Array(o/16*(i/16)).map((function(e){return.1})),[1,o/16,i/16,1])]),u=(c=c.reshape(c.shape.slice(1)).slice([0,0,0],[o,i,36])).dataSync();console.log("t",new Date-a);for(var l=new Float32Array(o*i*3),p=0;p!==o;p++)for(var m=0;m!==i;m++){for(var d=0,h=0,f=0;18!==f;f++)d<u[p*i*36+36*m+f]&&(d+=f*Math.pow(Math.max(u[p*i*36+36*m+f],0),2),h+=Math.pow(Math.max(u[p*i*36+36*m+f],0),2));var v=Math.min(Math.max(d/h*15,0),255);d=0,h=0;for(var x=0;18!==x;x++)d<u[p*i*36+36*m+x+18]&&(d+=x*Math.pow(Math.max(u[p*i*36+36*m+x+18],0),2),h+=Math.pow(Math.max(u[p*i*36+36*m+x+18],0),2));var M=Math.min(Math.max(d/h*15,0),255);l[p*i*3+3*m+0]=v,l[p*i*3+3*m+1]=M,l[p*i*3+3*m+2]=0}return n.tensor(l,[o,i,3],"int32").maximum(0).minimum(255).toInt()}catch(g){console.log("err: ",g),t.innerHTML=g.message}}));n.browser.toPixels(a,u).then((function(){t.innerHTML="req3",a.dispose(),requestAnimationFrame(e)})).catch((function(e){t.innerHTML=e.message}))},requestAnimationFrame(l);case 31:case"end":return e.stop()}}),e)}))),a.inited=!1,a}return Object(p.a)(t,[{key:"render",value:function(){var e=this;return console.log(this),Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)("video",{id:"video",style:{maxHeight:"200px"}}),Object(h.jsx)("canvas",{id:"result"}),Object(h.jsx)("div",{id:"but",onClick:function(){e.init().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"Play(v3)"}),Object(h.jsx)("div",{id:"but2",onClick:function(){e.initImg().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"imgClass"}),Object(h.jsx)("div",{id:"but",onClick:function(){e.initClass().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"PlayClass"}),Object(h.jsx)("pre",{id:"log"})]})}}]),t}(r.a.Component),v=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,19)).then((function(n){var t=n.getCLS,a=n.getFID,r=n.getFCP,i=n.getLCP,o=n.getTTFB;t(e),a(e),r(e),i(e),o(e)}))};o.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)(f,{})}),document.getElementById("root")),v()}},[[18,1,2]]]);
//# sourceMappingURL=main.ca9826ea.chunk.js.map