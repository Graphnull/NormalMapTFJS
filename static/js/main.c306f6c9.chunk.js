(this.webpackJsonpnormalmaptfjs=this.webpackJsonpnormalmaptfjs||[]).push([[0],{14:function(e,n,t){},16:function(e,n,t){},18:function(e,n,t){"use strict";t.r(n);var r=t(2),i=t.n(r),a=t(5),o=t.n(a),s=(t(14),t(1)),c=t.n(s),d=t(3),u=t(6),l=t(7),m=t(9),v=t(8),f=(t.p,t(16),t(0)),p=function(e){Object(m.a)(t,e);var n=Object(v.a)(t);function t(e){var r;return Object(u.a)(this,t),(r=n.call(this,e)).init=Object(d.a)(c.a.mark((function e(){var n,t,i,a,o,s,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.tf,!r.inited){e.next=3;break}return e.abrupt("return");case 3:return r.inited=!0,(t=document.getElementById("but")).innerHTML="started",e.next=8,n.loadGraphModel("/NormalMapTFJS/model/model.json");case 8:return i=e.sent,console.log(i),t.innerHTML="loaded",e.next=13,navigator.mediaDevices.getUserMedia({video:{aspectRatio:{ideal:1},facingMode:"environment"}});case 13:return a=e.sent,t.innerHTML="capture",(o=document.getElementById("video")).srcObject=a,e.next=19,o.play();case 19:s=document.getElementById("result"),s.getContext("2d"),d=function e(){var r=n.tidy((function(){t.innerHTML="req";try{var e=n.browser.fromPixels(o).expandDims().div(255);e=n.image.resizeBilinear(e,[512,512]),t.innerHTML="req1";var r=i.predict(e);return t.innerHTML="req2",r=r.reshape(r.shape.slice(1)).mul(.5).add(.5).maximum(0).minimum(1)}catch(a){t.innerHTML=a.message}}));n.browser.toPixels(r,s).then((function(){t.innerHTML="req3",r.dispose(),requestAnimationFrame(e)})).catch((function(e){t.innerHTML=e.message}))},requestAnimationFrame(d);case 23:case"end":return e.stop()}}),e)}))),r.initClass=Object(d.a)(c.a.mark((function e(){var n,t,i,a,o,s,d,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.tf,!r.inited){e.next=3;break}return e.abrupt("return");case 3:return r.inited=!0,(t=document.getElementById("but")).innerHTML="started",e.next=8,n.loadGraphModel("/NormalMapTFJS/modelClassOrient/model.json");case 8:return i=e.sent,console.log(i),DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&DeviceMotionEvent.requestPermission(),a=0,window.addEventListener("deviceorientation",(function(e){a=(e.beta-90)/180,t.innerHTML=""+e.beta})),t.innerHTML="loaded",e.next=16,navigator.mediaDevices.getUserMedia({video:{aspectRatio:{ideal:1.3333333333333333},facingMode:"environment"}});case 16:return o=e.sent,t.innerHTML="capture",(s=document.getElementById("video")).srcObject=o,e.next=22,s.play();case 22:d=document.getElementById("result"),d.getContext("2d"),u=function e(){var r=n.tidy((function(){t.innerHTML="req";try{var e=n.browser.fromPixels(s).expandDims().div(255);e=n.image.resizeBilinear(e,[768,1024]),t.innerHTML="req1";var r=new Date,o=i.predict({img:e,orient:n.tensor(new Float32Array(48).map((function(e){return a})),[1,6,8,1])});t.innerHTML="req2";var c=(o=o.reshape(o.shape.slice(1)).slice([0,0,0],[96,128,36])).dataSync();console.log("t",new Date-r);for(var d=new Float32Array(36864),u=0;96!==u;u++)for(var l=0;128!==l;l++){for(var m=-1/0,v=0,f=0;18!==f;f++)m<c[128*u*36+36*l+f]&&(m=c[128*u*36+36*l+f],v=f);var p=15*v;m=-1/0,v=0;for(var g=0;18!==g;g++)m<c[128*u*36+36*l+g+18]&&(m=c[128*u*36+36*l+g+18],v=g);var b=15*v;d[128*u*3+3*l+0]=p,d[128*u*3+3*l+1]=b,d[128*u*3+3*l+2]=0}return n.tensor(d,[96,128,3],"int32")}catch(M){console.log("err: ",M),t.innerHTML=M.message}}));console.log(r,d),n.browser.toPixels(r,d).then((function(){t.innerHTML="req3",r.dispose(),requestAnimationFrame(e)})).catch((function(e){t.innerHTML=e.message}))},requestAnimationFrame(u);case 26:case"end":return e.stop()}}),e)}))),r.initImg=Object(d.a)(c.a.mark((function e(){var n,t,i,a,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.tf,!r.inited){e.next=3;break}return e.abrupt("return");case 3:return r.inited=!0,(t=document.getElementById("but")).innerHTML="started",e.next=8,n.loadGraphModel("/NormalMapTFJS/modelClassOrient/model.json");case 8:return i=e.sent,console.log(i),t.innerHTML="loaded",e.next=13,new Promise((function(e){var n=new Image;n.onload=function(){return e(n)},n.src="/NormalMapTFJS/test.png"}));case 13:a=e.sent,t.innerHTML="capture",o=document.getElementById("result"),o.getContext("2d"),s=function e(){var r=n.tidy((function(){t.innerHTML="req";try{var e=n.browser.fromPixels(a).expandDims().div(255);t.innerHTML="req1";var r=new Date,o=i.predict({img:e,orient:n.tensor(new Float32Array(48).map((function(e){return.08})),[1,6,8,1])});t.innerHTML="req2";var s=(o=o.reshape(o.shape.slice(1)).slice([0,0,0],[96,128,36])).dataSync();console.log("t",new Date-r);for(var c=new Float32Array(36864),d=0;96!==d;d++)for(var u=0;128!==u;u++){for(var l=-1/0,m=0,v=0;18!==v;v++)l<s[128*d*36+36*u+v]&&(l=s[128*d*36+36*u+v],m=v);var f=15*m;l=-1/0,m=0;for(var p=0;18!==p;p++)l<s[128*d*36+36*u+p+18]&&(l=s[128*d*36+36*u+p+18],m=p);var g=15*m;c[128*d*3+3*u+0]=f,c[128*d*3+3*u+1]=g,c[128*d*3+3*u+2]=0}return n.tensor(c,[96,128,3],"int32")}catch(b){console.log("err: ",b),t.innerHTML=b.message}}));console.log(r,o),n.browser.toPixels(r,o).then((function(){t.innerHTML="req3",r.dispose(),requestAnimationFrame(e)})).catch((function(e){t.innerHTML=e.message}))},requestAnimationFrame(s);case 19:case"end":return e.stop()}}),e)}))),r.inited=!1,r}return Object(l.a)(t,[{key:"render",value:function(){var e=this;return console.log(this),Object(f.jsxs)("div",{className:"App",children:[Object(f.jsx)("video",{id:"video"}),Object(f.jsx)("canvas",{id:"result"}),Object(f.jsx)("div",{id:"but",onClick:function(){e.init().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"Play(v3)"}),Object(f.jsx)("div",{id:"but2",onClick:function(){e.initImg().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"imgClass"}),Object(f.jsx)("div",{id:"but",onClick:function(){e.initClass().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"PlayClass"})]})}}]),t}(i.a.Component),g=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,19)).then((function(n){var t=n.getCLS,r=n.getFID,i=n.getFCP,a=n.getLCP,o=n.getTTFB;t(e),r(e),i(e),a(e),o(e)}))};o.a.render(Object(f.jsx)(i.a.StrictMode,{children:Object(f.jsx)(p,{})}),document.getElementById("root")),g()}},[[18,1,2]]]);
//# sourceMappingURL=main.c306f6c9.chunk.js.map