(this.webpackJsonpnormalmaptfjs=this.webpackJsonpnormalmaptfjs||[]).push([[0],{14:function(e,n,t){},16:function(e,n,t){},18:function(e,n,t){"use strict";t.r(n);var r=t(1),a=t.n(r),i=t(5),o=t.n(i),s=(t(14),t(2)),c=t.n(s),u=t(4),l=t(6),p=t(7),d=t(9),m=t(8),f=(t.p,t(16),t(0)),h=function(e){Object(d.a)(t,e);var n=Object(m.a)(t);function t(e){var r;return Object(l.a)(this,t),(r=n.call(this,e)).initClass=Object(u.a)(c.a.mark((function e(){var n,t,a,i,o,s,u,l,p,d,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.tf,!r.inited){e.next=3;break}return e.abrupt("return");case 3:return r.inited=!0,t=document.getElementById("log"),(a=function(e){t.innerHTML+=e+"\n"})("started"),e.prev=7,e.next=10,n.loadLayersModel("/NormalMapTFJS/modelClassOrient/model.json");case 10:return i=e.sent,console.log(i),o=64,s=64,i.inputs[0].shape=[null,8*s,8*o,3],i.inputLayers[0].batchInputShape=[null,8*s,8*o,3],i.inputLayers[0].inputSpec[0].shape=[null,8*s,8*o,3],i.feedInputShapes[0]=[null,8*s,8*o,3],i.internalInputShapes[0]=[null,8*s,8*o,3],i.inputs[1].shape=[null,s/16,o/16,1],i.inputLayers[1].batchInputShape=[null,s/16,o/16,1],i.inputLayers[1].inputSpec[0].shape=[null,s/16,o/16,1],i.feedInputShapes[1]=[null,s/16,o/16,1],i.internalInputShapes[1]=[null,s/16,o/16,1],DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&DeviceMotionEvent.requestPermission(),u=0,window.addEventListener("deviceorientation",(function(e){u=(e.beta-90)/180})),a("loaded"),e.next=30,navigator.mediaDevices.getUserMedia({video:{aspectRatio:{ideal:1},facingMode:"environment"}});case 30:return l=e.sent,a("capture"),(p=document.getElementById("video")).srcObject=l,e.next=36,p.play();case 36:d=document.getElementById("result"),d.getContext("2d"),m=function e(){var t=n.tidy((function(){a("req");try{var e=n.browser.fromPixels(p).expandDims().div(255);e=n.image.resizeBilinear(e,[512,512]),a("req1");var t=new Date,r=i.predict([e,n.tensor(new Float32Array(s/16*(o/16)).map((function(e){return u})),[1,s/16,o/16,1])]);a("req2");var c=(r=r.reshape(r.shape.slice(1)).slice([0,0,0],[s,o,36])).dataSync();console.log("t",new Date-t);for(var l=new Float32Array(s*o*3),d=0;d!==s;d++)for(var m=0;m!==o;m++){for(var f=-1/0,h=0;18!==h;h++)f<c[d*o*36+36*m+h]&&(f=c[d*o*36+36*m+h],h);var v=255*f;f=-1/0,0;for(var g=0;18!==g;g++)f<c[d*o*36+36*m+g+18]&&(f=c[d*o*36+36*m+g+18],g);var b=255*f;l[d*o*3+3*m+0]=v,l[d*o*3+3*m+1]=b,l[d*o*3+3*m+2]=0}return n.tensor(l,[s,o,3],"int32").maximum(0).minimum(255).toInt()}catch(y){console.log("err: ",y),a(y.message)}}));console.log(t,d),n.browser.toPixels(t,d).then((function(){a("req3"),t.dispose(),requestAnimationFrame(e)})).catch((function(e){a(e.message)}))},requestAnimationFrame(m),e.next=45;break;case 42:e.prev=42,e.t0=e.catch(7),a(e.t0.message);case 45:case"end":return e.stop()}}),e,null,[[7,42]])}))),r.initImg=Object(u.a)(c.a.mark((function e(){var n,t,a,i,o,s,u,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.tf,!r.inited){e.next=3;break}return e.abrupt("return");case 3:return r.inited=!0,(t=document.getElementById("but")).innerHTML="started",e.next=8,n.loadLayersModel("/NormalMapTFJS/modelClassOrient/model.json");case 8:return a=e.sent,console.log(a),i=64,o=64,a.inputs[0].shape=[null,8*o,8*i,3],a.inputLayers[0].batchInputShape=[null,8*o,8*i,3],a.inputLayers[0].inputSpec[0].shape=[null,8*o,8*i,3],a.feedInputShapes[0]=[null,8*o,8*i,3],a.internalInputShapes[0]=[null,8*o,8*i,3],a.inputs[1].shape=[null,o/16,i/16,1],a.inputLayers[1].batchInputShape=[null,o/16,i/16,1],a.inputLayers[1].inputSpec[0].shape=[null,o/16,i/16,1],a.feedInputShapes[1]=[null,o/16,i/16,1],a.internalInputShapes[1]=[null,o/16,i/16,1],t.innerHTML="loaded",e.next=25,new Promise((function(e){var n=new Image;n.onload=function(){return e(n)},n.src="/NormalMapTFJS/test.png"}));case 25:s=e.sent,t.innerHTML="capture",u=document.getElementById("result"),u.getContext("2d"),l=function e(){var r=n.tidy((function(){t.innerHTML="req";try{var e=n.browser.fromPixels(s).expandDims().div(255);e=n.image.resizeBilinear(e,[8*o,8*i]);var r=new Date,c=a.predict([e,n.tensor(new Float32Array(o/16*(i/16)).map((function(e){return.1})),[1,o/16,i/16,1])]),u=(c=c.reshape(c.shape.slice(1)).slice([0,0,0],[o,i,36])).dataSync();console.log("t",new Date-r);for(var l=new Float32Array(o*i*3),p=0;p!==o;p++)for(var d=0;d!==i;d++){for(var m=-1/0,f=0;18!==f;f++)m<u[p*i*36+36*d+f]&&(m=u[p*i*36+36*d+f],f);var h=255*m;m=-1/0,0;for(var v=0;18!==v;v++)m<u[p*i*36+36*d+v+18]&&(m=u[p*i*36+36*d+v+18],v);var g=255*m;l[p*i*3+3*d+0]=h,l[p*i*3+3*d+1]=g,l[p*i*3+3*d+2]=0}return n.tensor(l,[o,i,3],"int32").maximum(0).minimum(255).toInt()}catch(b){console.log("err: ",b),t.innerHTML=b.message}}));n.browser.toPixels(r,u).then((function(){t.innerHTML="req3",r.dispose(),requestAnimationFrame(e)})).catch((function(e){t.innerHTML=e.message}))},requestAnimationFrame(l);case 31:case"end":return e.stop()}}),e)}))),r.inited=!1,r}return Object(p.a)(t,[{key:"render",value:function(){var e=this;return console.log(this),Object(f.jsxs)("div",{className:"App",children:[Object(f.jsx)("video",{id:"video",style:{maxHeight:"200px"}}),Object(f.jsx)("canvas",{id:"result"}),Object(f.jsx)("div",{id:"but",onClick:function(){e.init().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"Play(v3)"}),Object(f.jsx)("div",{id:"but2",onClick:function(){e.initImg().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"imgClass"}),Object(f.jsx)("div",{id:"but",onClick:function(){e.initClass().catch((function(e){console.error(e),document.body.innerText=e.message}))},children:"PlayClass"}),Object(f.jsx)("pre",{id:"log"})]})}}]),t}(a.a.Component),v=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,19)).then((function(n){var t=n.getCLS,r=n.getFID,a=n.getFCP,i=n.getLCP,o=n.getTTFB;t(e),r(e),a(e),i(e),o(e)}))};o.a.render(Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(h,{})}),document.getElementById("root")),v()}},[[18,1,2]]]);
//# sourceMappingURL=main.ff6a88b4.chunk.js.map